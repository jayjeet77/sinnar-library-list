
<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>सिन्नर सार्वजनिक वाचनालय - डिजिटल सूची</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f7f9fc; font-family: 'Segoe UI', Arial, sans-serif; }
        .header-section { background: #ffffff; padding: 30px 15px; text-align: center; border-bottom: 5px solid #0056b3; }
        .logo-img { max-width: 140px; margin-bottom: 15px; display: block; margin-left: auto; margin-right: auto; }
        .search-container { position: sticky; top: 0; background: #f7f9fc; padding: 15px 0; z-index: 1000; }
        .book-card { background: white; border-radius: 8px; padding: 15px; margin-bottom: 12px; border-left: 6px solid #0056b3; box-shadow: 0 2px 4px rgba(0,0,0,0.06); }
        .sno-badge { background: #0056b3; color: white; min-width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: bold; margin-right: 15px; font-size: 0.85em; flex-shrink: 0; }
        .category-tag { font-size: 0.72rem; background: #e3f2fd; color: #0056b3; padding: 4px 12px; border-radius: 20px; font-weight: bold; }
        .footer { text-align: center; padding: 25px; background: #212529; color: white; margin-top: 50px; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 2s linear infinite; display: inline-block; vertical-align: middle; margin-right: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="header-section shadow-sm">
    <img src="logo.png" alt="सिन्नर सार्वजनिक वाचनालय लोगो" class="logo-img" onerror="this.src='https://via.placeholder.com/150x150?text=वाचनालय+लोगो';">
    <h2 class="fw-bold text-dark">सिन्नर सार्वजनिक वाचनालय</h2>
    <p class="mb-0 text-muted fw-semibold">सिन्नर ता. सिन्नर | संकलन आणि सूचीकरण : जितेंद्र जगताप</p>
</div>

<div class="search-container">
    <div class="container px-3" style="max-width: 800px;">
        <input type="text" id="searchInput" class="form-control form-control-lg border-primary shadow-sm" placeholder="कादंबरी, लेखक किंवा पुस्तक शोधा..." disabled>
        <div id="results-info" class="text-center mt-2 text-muted small">
            <span id="loading-msg"><div class="loader"></div> माहिती लोड होत आहे, कृपया थांबा...</span>
            <span id="count-msg" style="display:none;">एकूण ग्रंथ: <span id="total-count">0</span> | सापडलेले: <span id="results-count">0</span></span>
        </div>
    </div>
</div>

<div class="container mt-2">
    <div id="bookList"></div>
    <div id="loadMore" class="text-center p-4 text-muted" style="display:none;">आणखी निकाल पाहण्यासाठी अधिक अचूक शब्द टाइप करा...</div>
</div>

<div class="footer">
    <p class="mb-0">सिन्नर सार्वजनिक वाचनालय, सिन्नर</p>
</div>

<script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/1zskDx0OIbMyzY5Sj_7GBS1iokrZY_5KnPn9jsW3dDNc/export?format=csv";
    let books = [];

    const searchInput = document.getElementById('searchInput');
    const bookList = document.getElementById('bookList');
    const resultsCount = document.getElementById('results-count');
    const totalCount = document.getElementById('total-count');
    const loadingMsg = document.getElementById('loading-msg');
    const countMsg = document.getElementById('count-msg');

    // Fetch and Parse CSV
    async function fetchData() {
        try {
            const response = await fetch(CSV_URL);
            const data = await response.text();
            parseCSV(data);
        } catch (error) {
            console.error("Error fetching data:", error);
            loadingMsg.innerHTML = "माहिती लोड करताना अडचण आली. कृपया इंटरनेट तपासा.";
        }
    }

    function parseCSV(text) {
        const lines = text.split('\n');
        const headers = lines[0].split(',').map(h => h.trim());
        
        const rawBooks = [];
        for (let i = 1; i < lines.length; i++) {
            if (!lines[i].trim()) continue;
            
            // Simple CSV split (not handling commas inside quotes for simplicity unless needed)
            const cols = lines[i].split(',').map(c => c.trim());
            const book = {};
            headers.forEach((h, index) => {
                book[h] = cols[index] || "";
            });
            rawBooks.push(book);
        }

        // Sorting Logic
        const sortPriority = (cat) => {
            if (cat === "कादंबरी") return 0;
            if (cat === "धार्मिक") return 99;
            return 10;
        };

        books = rawBooks.sort((a, b) => {
            const rankA = sortPriority(a.Class);
            const rankB = sortPriority(b.Class);
            if (rankA !== rankB) return rankA - rankB;
            return parseInt(a["S.No."]) - parseInt(b["S.No."]);
        });

        // UI Update
        loadingMsg.style.display = 'none';
        countMsg.style.display = 'inline';
        totalCount.innerText = books.length.toLocaleString();
        searchInput.disabled = false;
        renderBooks();
    }

    function renderBooks(filter = '') {
        bookList.innerHTML = '';
        const query = filter.toLowerCase().trim();
        const filtered = books.filter(b => 
            (b['Name of Book'] && b['Name of Book'].toLowerCase().includes(query)) ||
            (b['Author'] && b['Author'].toLowerCase().includes(query)) ||
            (b['Class'] && b['Class'].toLowerCase().includes(query)) ||
            (b['S.No.'] && b['S.No.'].toString().includes(query))
        );

        resultsCount.innerText = filtered.length.toLocaleString();
        const limit = 400;
        const toShow = filtered.slice(0, limit);
        document.getElementById('loadMore').style.display = filtered.length > limit ? 'block' : 'none';

        if (toShow.length === 0) {
            bookList.innerHTML = '<div class="text-center p-5 text-muted bg-white border rounded">माहिती सापडली नाही.</div>';
            return;
        }

        toShow.forEach(b => {
            const div = document.createElement('div');
            div.className = 'book-card d-flex align-items-center shadow-sm';
            div.innerHTML = `
                <div class="sno-badge">${b['S.No.']}</div>
                <div class="flex-grow-1">
                    <div class="d-flex justify-content-between align-items-start">
                        <h6 class="mb-1 fw-bold text-primary">${b['Name of Book']}</h6>
                        <span class="category-tag">${b['Class']}</span>
                    </div>
                    <div class="small text-muted">लेखक: ${b['Author']} | प्रकाशन: ${b['Publication']}</div>
                </div>
            `;
            bookList.appendChild(div);
        });
    }

    let debounce;
    searchInput.addEventListener('input', (e) => {
        clearTimeout(debounce);
        debounce = setTimeout(() => renderBooks(e.target.value), 300);
    });

    fetchData();
</script>
</body>
</html>
